<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Limpeza JSON</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            height: 150px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        code {
            background: #f8f9fa;
            color: #e83e8c;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            font-weight: bold;
        }
        .info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .info li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Limpeza JSON</h1>
        <p>Use este arquivo para testar a funcionalidade de limpeza de JSON que resolve o erro "Unexpected token"</p>
        <div class="info">
            <strong>Novas funcionalidades:</strong> 
            <br>üîç A IA prioriza t√≠tulos com "#" (ex: "#6287 ¬∑ FUNCIONALIDADE UNLOCK SURPRISE")
            <br>üßπ Remove automaticamente c√≥digos entre aspas, par√™nteses, colchetes e chaves!
        </div>
        
        <h3>Entrada (JSON com formata√ß√£o markdown):</h3>
        <textarea id="input" placeholder="Cole aqui o JSON com formata√ß√£o markdown...">```json
{
  "mainFolder": {
    "number": "001",
    "name": "PROJETO_TESTE"
  },
  "subfolders": [
    {
      "number": "1",
      "name": "DESIGN"
    },
    {
      "number": "2",
      "name": "DESENVOLVIMENTO"
    }
  ]
}
```</textarea>

        <button onclick="cleanJSON()">üßπ Limpar JSON</button>
        <button onclick="testExamples()">üìù Testar Exemplos</button>
        <button onclick="clearAll()">üóëÔ∏è Limpar Tudo</button>

        <h3>Resultado:</h3>
        <textarea id="output" placeholder="Resultado da limpeza aparecer√° aqui..." readonly></textarea>

        <div id="result"></div>

        <h3>Exemplos de Problemas Comuns:</h3>
        <div>
            <button onclick="testExample1()">Teste 1: ```json```</button>
            <button onclick="testExample2()">Teste 2: ``` apenas</button>
            <button onclick="testExample3()">Teste 3: Com backticks</button>
            <button onclick="testExample4()">Teste 4: JSON v√°lido</button>
            <button onclick="testHashtagExample()">Teste 5: Hashtag #6287</button>
            <button onclick="testCleaningExample()">Teste 6: Limpeza (MKT)</button>
        </div>

        <h3>üéØ Funcionalidades da IA:</h3>
        
        <div class="info">
            <h4>üîç Detec√ß√£o de Hashtags:</h4>
            <p><strong>Exemplo de entrada que a IA detecta:</strong></p>
            <code>#6287 ¬∑ FUNCIONALIDADE UNLOCK SURPRISE</code>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>N√∫mero da pasta: <strong>6287</strong></li>
                <li>Nome da pasta: <strong>FUNCIONALIDADE UNLOCK SURPRISE</strong></li>
            </ul>
        </div>

        <div class="info">
            <h4>üßπ Limpeza Autom√°tica de Texto (Nova!):</h4>
            <p><strong>A IA remove automaticamente:</strong></p>
            <ul>
                <li><code>(MKT)</code> ‚Üí par√™nteses e conte√∫do</li>
                <li><code>[URGENTE]</code> ‚Üí colchetes e conte√∫do</li>
                <li><code>"C√ìDIGO"</code> ‚Üí aspas e conte√∫do</li>
                <li><code>{CATEGORIA}</code> ‚Üí chaves e conte√∫do</li>
            </ul>
            <p><strong>Exemplos:</strong></p>
            <ul>
                <li><code>#6287 ¬∑ FUNCIONALIDADE UNLOCK SURPRISE (MKT)</code> ‚Üí <strong>FUNCIONALIDADE UNLOCK SURPRISE</strong></li>
                <li><code>1. DESIGN (CRIATIVO) "V2"</code> ‚Üí <strong>DESIGN</strong></li>
                <li><code>2. DESENVOLVIMENTO [BACKEND]</code> ‚Üí <strong>DESENVOLVIMENTO</strong></li>
            </ul>
        </div>
    </div>

    <script>
        function cleanJSON() {
            const input = document.getElementById('input').value;
            const output = document.getElementById('output');
            const result = document.getElementById('result');
            
            try {
                // Aplicar a mesma l√≥gica de limpeza do script principal
                let cleaned = input.trim();
                
                // Remove markdown code blocks if present
                if (cleaned.startsWith('```json')) {
                    cleaned = cleaned.replace(/```json\n?/, '').replace(/\n?```$/, '');
                }
                if (cleaned.startsWith('```')) {
                    cleaned = cleaned.replace(/```\n?/, '').replace(/\n?```$/, '');
                }
                
                // Remove any remaining backticks
                cleaned = cleaned.replace(/`/g, '');
                
                // Trim again after cleaning
                cleaned = cleaned.trim();
                
                output.value = cleaned;
                
                // Tentar fazer parse do JSON
                try {
                    const parsed = JSON.parse(cleaned);
                    result.innerHTML = '<div class="success">‚úÖ JSON v√°lido! Estrutura: ' + JSON.stringify(parsed, null, 2) + '</div>';
                } catch (parseError) {
                    // Tentar encontrar JSON v√°lido na resposta
                    const jsonMatch = cleaned.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        try {
                            const recovered = JSON.parse(jsonMatch[0]);
                            result.innerHTML = '<div class="info">‚ö†Ô∏è JSON recuperado com fallback: ' + JSON.stringify(recovered, null, 2) + '</div>';
                        } catch (secondError) {
                            result.innerHTML = '<div class="error">‚ùå Erro: ' + parseError.message + '</div>';
                        }
                    } else {
                        result.innerHTML = '<div class="error">‚ùå Erro: ' + parseError.message + '</div>';
                    }
                }
                
            } catch (error) {
                result.innerHTML = '<div class="error">‚ùå Erro geral: ' + error.message + '</div>';
            }
        }

        function testExamples() {
            const examples = [
                '```json\n{"mainFolder":{"number":"001","name":"TESTE"},"subfolders":[]}\n```',
                '```\n{"mainFolder":null,"subfolders":[]}\n```',
                '{"mainFolder":`null`,"subfolders":[]}',
                '{"mainFolder":{"number":"001","name":"PROJETO"},"subfolders":[{"number":"1","name":"DESIGN"}]}',
                '```json\n{"mainFolder":{"number":"6287","name":"FUNCIONALIDADE UNLOCK SURPRISE"},"subfolders":[{"number":"1","name":"STORY E ANUNCIO ADS"}]}\n```',
                '```json\n{"mainFolder":{"number":"6287","name":"FUNCIONALIDADE UNLOCK SURPRISE"},"subfolders":[{"number":"1","name":"DESIGN"},{"number":"2","name":"DESENVOLVIMENTO"}]}\n```'
            ];
            
            const exampleNames = [
                'JSON com ```json```',
                'JSON com ``` apenas',
                'JSON com backticks',
                'JSON v√°lido simples',
                'JSON com hashtag #6287',
                'JSON com limpeza autom√°tica'
            ];
            
            let results = '<h4>Resultados dos Testes:</h4>';
            examples.forEach((example, index) => {
                document.getElementById('input').value = example;
                cleanJSON();
                const result = document.getElementById('result').innerHTML;
                results += `<div><strong>${exampleNames[index]}:</strong> ${result}</div><br>`;
            });
            
            document.getElementById('result').innerHTML = results;
        }

        function testExample1() {
            document.getElementById('input').value = '```json\n{\n  "mainFolder": {\n    "number": "001",\n    "name": "PROJETO_TESTE"\n  },\n  "subfolders": []\n}\n```';
            cleanJSON();
        }

        function testExample2() {
            document.getElementById('input').value = '```\n{"mainFolder":null,"subfolders":[]}\n```';
            cleanJSON();
        }

        function testExample3() {
            document.getElementById('input').value = '{"mainFolder":`null`,"subfolders":[]}';
            cleanJSON();
        }

        function testExample4() {
            document.getElementById('input').value = '{"mainFolder":{"number":"001","name":"PROJETO"},"subfolders":[{"number":"1","name":"DESIGN"}]}';
            cleanJSON();
        }

        function testHashtagExample() {
            document.getElementById('input').value = '```json\n{\n  "mainFolder": {\n    "number": "6287",\n    "name": "FUNCIONALIDADE UNLOCK SURPRISE"\n  },\n  "subfolders": [\n    {\n      "number": "1",\n      "name": "STORY E ANUNCIO ADS"\n    },\n    {\n      "number": "2",\n      "name": "REELS E ANUNCIO ADS VOICE OVER"\n    },\n    {\n      "number": "3",\n      "name": "POP-UP HOME NUTRITION"\n    }\n  ]\n}\n```';
            cleanJSON();
        }

        function testCleaningExample() {
            document.getElementById('input').value = '```json\n{\n  "mainFolder": {\n    "number": "6287",\n    "name": "FUNCIONALIDADE UNLOCK SURPRISE"\n  },\n  "subfolders": [\n    {\n      "number": "1",\n      "name": "STORY E ANUNCIO ADS"\n    },\n    {\n      "number": "2",\n      "name": "DESIGN"\n    },\n    {\n      "number": "3",\n      "name": "DESENVOLVIMENTO"\n    }\n  ]\n}\n```';
            cleanJSON();
        }

        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('output').value = '';
            document.getElementById('result').innerHTML = '';
        }
    </script>
</body>
</html> 